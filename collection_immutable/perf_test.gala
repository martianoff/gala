package main

import (
    "fmt"
    "time"
    . "martianoff/gala/collection_immutable"
)

// Performance test utilities
func measureNs(iterations int, f func() any) int64 {
    var start = time.Now()
    for i := 0; i < iterations; i++ {
        f()
    }
    var elapsed = time.Since(start)
    return elapsed.Nanoseconds() / int64(iterations)
}

func printResult(name string, nsPerOp int64) {
    fmt.Printf("%-40s %12d ns/op\n", name, nsPerOp)
}

// ============ LIST BENCHMARKS ============

// List creation benchmark - small
func benchListCreation100() {
    var ns = measureNs(1000, () => {
        var list = EmptyList[int]()
        for i := 0; i < 100; i++ {
            list = list.Prepend(i)
        }
    })
    printResult("List.Creation(100)", ns)
}

// List creation benchmark - medium
func benchListCreation10000() {
    var ns = measureNs(100, () => {
        var list = EmptyList[int]()
        for i := 0; i < 10000; i++ {
            list = list.Prepend(i)
        }
    })
    printResult("List.Creation(10000)", ns)
}

// List creation benchmark - large
func benchListCreation100000() {
    var ns = measureNs(10, () => {
        var list = EmptyList[int]()
        for i := 0; i < 100000; i++ {
            list = list.Prepend(i)
        }
    })
    printResult("List.Creation(100000)", ns)
}

// List prepend benchmark
func benchListPrepend() {
    var list = EmptyList[int]()
    for i := 0; i < 10000; i++ {
        list = list.Prepend(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = list.Prepend(999)
    })
    printResult("List.Prepend (size=10000)", ns)
}

// List head benchmark
func benchListHead() {
    var list = EmptyList[int]()
    for i := 0; i < 10000; i++ {
        list = list.Prepend(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = list.Head()
    })
    printResult("List.Head (size=10000)", ns)
}

// List get benchmark - beginning
func benchListGetFirst() {
    var list = EmptyList[int]()
    for i := 0; i < 10000; i++ {
        list = list.Prepend(i)
    }
    var ns = measureNs(100000, () => {
        var _ = list.Get(0)
    })
    printResult("List.Get(0) (size=10000)", ns)
}

// List get benchmark - middle
func benchListGetMiddle() {
    var list = EmptyList[int]()
    for i := 0; i < 10000; i++ {
        list = list.Prepend(i)
    }
    var ns = measureNs(1000, () => {
        var _ = list.Get(5000)
    })
    printResult("List.Get(5000) (size=10000)", ns)
}

// List filter benchmark
func benchListFilter() {
    var list = EmptyList[int]()
    for i := 0; i < 10000; i++ {
        list = list.Prepend(i)
    }
    var ns = measureNs(100, () => {
        var _ = list.Filter((x int) => x % 2 == 0)
    })
    printResult("List.Filter (size=10000)", ns)
}

// List map benchmark
func benchListMap() {
    var list = EmptyList[int]()
    for i := 0; i < 10000; i++ {
        list = list.Prepend(i)
    }
    var ns = measureNs(100, () => {
        var _ = list.Map((x int) => x * 2)
    })
    printResult("List.Map (size=10000)", ns)
}

// List foldLeft benchmark
func benchListFoldLeft() {
    var list = EmptyList[int]()
    for i := 0; i < 10000; i++ {
        list = list.Prepend(i)
    }
    var ns = measureNs(1000, () => {
        var _ = List_FoldLeft[int](list, 0, (acc int, x int) => acc + x)
    })
    printResult("List.FoldLeft (size=10000)", ns)
}

// ============ ARRAY (VECTOR) BENCHMARKS ============

// Array creation benchmark - small
func benchArrayCreation100() {
    var ns = measureNs(1000, () => {
        var arr = EmptyArray[int]()
        for i := 0; i < 100; i++ {
            arr = arr.Append(i)
        }
    })
    printResult("Array.Creation(100)", ns)
}

// Array creation benchmark - medium
func benchArrayCreation10000() {
    var ns = measureNs(100, () => {
        var arr = EmptyArray[int]()
        for i := 0; i < 10000; i++ {
            arr = arr.Append(i)
        }
    })
    printResult("Array.Creation(10000)", ns)
}

// Array creation benchmark - large
func benchArrayCreation100000() {
    var ns = measureNs(10, () => {
        var arr = EmptyArray[int]()
        for i := 0; i < 100000; i++ {
            arr = arr.Append(i)
        }
    })
    printResult("Array.Creation(100000)", ns)
}

// Array append benchmark
func benchArrayAppend() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(100000, () => {
        var _ = arr.Append(999)
    })
    printResult("Array.Append (size=10000)", ns)
}

// Array prepend benchmark
func benchArrayPrepend() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(100, () => {
        var _ = arr.Prepend(999)
    })
    printResult("Array.Prepend (size=10000)", ns)
}

// Array head benchmark
func benchArrayHead() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = arr.Head()
    })
    printResult("Array.Head (size=10000)", ns)
}

// Array get benchmark - beginning
func benchArrayGetFirst() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = arr.Get(0)
    })
    printResult("Array.Get(0) (size=10000)", ns)
}

// Array get benchmark - middle
func benchArrayGetMiddle() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = arr.Get(5000)
    })
    printResult("Array.Get(5000) (size=10000)", ns)
}

// Array get benchmark - end
func benchArrayGetLast() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = arr.Get(9999)
    })
    printResult("Array.Get(9999) (size=10000)", ns)
}

// Array update benchmark
func benchArrayUpdate() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(100000, () => {
        var _ = arr.Updated(5000, 999)
    })
    printResult("Array.Updated(5000) (size=10000)", ns)
}

// Array filter benchmark
func benchArrayFilter() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(100, () => {
        var _ = arr.Filter((x int) => x % 2 == 0)
    })
    printResult("Array.Filter (size=10000)", ns)
}

// Array map benchmark
func benchArrayMap() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(100, () => {
        var _ = arr.Map((x int) => x * 2)
    })
    printResult("Array.Map (size=10000)", ns)
}

// Array foldLeft benchmark
func benchArrayFoldLeft() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(1000, () => {
        var _ = Array_FoldLeft[int](arr, 0, (acc int, x int) => acc + x)
    })
    printResult("Array.FoldLeft (size=10000)", ns)
}

// Array take benchmark
func benchArrayTake() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(1000, () => {
        var _ = arr.Take(5000)
    })
    printResult("Array.Take(5000) (size=10000)", ns)
}

// Array drop benchmark
func benchArrayDrop() {
    var arr = EmptyArray[int]()
    for i := 0; i < 10000; i++ {
        arr = arr.Append(i)
    }
    var ns = measureNs(1000, () => {
        var _ = arr.Drop(5000)
    })
    printResult("Array.Drop(5000) (size=10000)", ns)
}

// ============ HASHSET BENCHMARKS ============

// HashSet creation benchmark - small
func benchHashSetCreation100() {
    var ns = measureNs(1000, () => {
        var set = EmptyHashSet[int]()
        for i := 0; i < 100; i++ {
            set = set.Add(i)
        }
    })
    printResult("HashSet.Creation(100)", ns)
}

// HashSet creation benchmark - medium
func benchHashSetCreation10000() {
    var ns = measureNs(100, () => {
        var set = EmptyHashSet[int]()
        for i := 0; i < 10000; i++ {
            set = set.Add(i)
        }
    })
    printResult("HashSet.Creation(10000)", ns)
}

// HashSet creation benchmark - large
func benchHashSetCreation100000() {
    var ns = measureNs(10, () => {
        var set = EmptyHashSet[int]()
        for i := 0; i < 100000; i++ {
            set = set.Add(i)
        }
    })
    printResult("HashSet.Creation(100000)", ns)
}

// HashSet add benchmark (single element)
func benchHashSetAdd() {
    var set = EmptyHashSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(100000, () => {
        var _ = set.Add(99999)
    })
    printResult("HashSet.Add (size=10000)", ns)
}

// HashSet contains benchmark - hit
func benchHashSetContainsHit() {
    var set = EmptyHashSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = set.Contains(5000)
    })
    printResult("HashSet.Contains (hit, size=10000)", ns)
}

// HashSet contains benchmark - miss
func benchHashSetContainsMiss() {
    var set = EmptyHashSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = set.Contains(20000)
    })
    printResult("HashSet.Contains (miss, size=10000)", ns)
}

// HashSet remove benchmark
func benchHashSetRemove() {
    var set = EmptyHashSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(100000, () => {
        var _ = set.Remove(5000)
    })
    printResult("HashSet.Remove (size=10000)", ns)
}

// HashSet filter benchmark
func benchHashSetFilter() {
    var set = EmptyHashSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(100, () => {
        var _ = set.Filter((x int) => x % 2 == 0)
    })
    printResult("HashSet.Filter (size=10000)", ns)
}

// HashSet union benchmark
func benchHashSetUnion() {
    var set1 = EmptyHashSet[int]()
    var set2 = EmptyHashSet[int]()
    for i := 0; i < 1000; i++ {
        set1 = set1.Add(i)
        set2 = set2.Add(i + 500)
    }
    var ns = measureNs(100, () => {
        var _ = set1.Union(set2)
    })
    printResult("HashSet.Union (2x1000)", ns)
}

// HashSet intersection benchmark
func benchHashSetIntersect() {
    var set1 = EmptyHashSet[int]()
    var set2 = EmptyHashSet[int]()
    for i := 0; i < 1000; i++ {
        set1 = set1.Add(i)
        set2 = set2.Add(i + 500)
    }
    var ns = measureNs(100, () => {
        var _ = set1.Intersect(set2)
    })
    printResult("HashSet.Intersect (2x1000)", ns)
}

// ============ TREESET BENCHMARKS ============

// TreeSet creation benchmark - small
func benchTreeSetCreation100() {
    var ns = measureNs(1000, () => {
        var set = EmptyTreeSet[int]()
        for i := 0; i < 100; i++ {
            set = set.Add(i)
        }
    })
    printResult("TreeSet.Creation(100)", ns)
}

// TreeSet creation benchmark - medium
func benchTreeSetCreation10000() {
    var ns = measureNs(100, () => {
        var set = EmptyTreeSet[int]()
        for i := 0; i < 10000; i++ {
            set = set.Add(i)
        }
    })
    printResult("TreeSet.Creation(10000)", ns)
}

// TreeSet creation benchmark - large
func benchTreeSetCreation100000() {
    var ns = measureNs(10, () => {
        var set = EmptyTreeSet[int]()
        for i := 0; i < 100000; i++ {
            set = set.Add(i)
        }
    })
    printResult("TreeSet.Creation(100000)", ns)
}

// TreeSet add benchmark (single element)
func benchTreeSetAdd() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(100000, () => {
        var _ = set.Add(99999)
    })
    printResult("TreeSet.Add (size=10000)", ns)
}

// TreeSet contains benchmark - hit
func benchTreeSetContainsHit() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = set.Contains(5000)
    })
    printResult("TreeSet.Contains (hit, size=10000)", ns)
}

// TreeSet contains benchmark - miss
func benchTreeSetContainsMiss() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = set.Contains(20000)
    })
    printResult("TreeSet.Contains (miss, size=10000)", ns)
}

// TreeSet remove benchmark
func benchTreeSetRemove() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(100000, () => {
        var _ = set.Remove(5000)
    })
    printResult("TreeSet.Remove (size=10000)", ns)
}

// TreeSet min benchmark
func benchTreeSetMin() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = set.Min()
    })
    printResult("TreeSet.Min (size=10000)", ns)
}

// TreeSet max benchmark
func benchTreeSetMax() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(1000000, () => {
        var _ = set.Max()
    })
    printResult("TreeSet.Max (size=10000)", ns)
}

// TreeSet filter benchmark
func benchTreeSetFilter() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(100, () => {
        var _ = set.Filter((x int) => x % 2 == 0)
    })
    printResult("TreeSet.Filter (size=10000)", ns)
}

// TreeSet union benchmark
func benchTreeSetUnion() {
    var set1 = EmptyTreeSet[int]()
    var set2 = EmptyTreeSet[int]()
    for i := 0; i < 1000; i++ {
        set1 = set1.Add(i)
        set2 = set2.Add(i + 500)
    }
    var ns = measureNs(100, () => {
        var _ = set1.Union(set2)
    })
    printResult("TreeSet.Union (2x1000)", ns)
}

// TreeSet intersection benchmark
func benchTreeSetIntersect() {
    var set1 = EmptyTreeSet[int]()
    var set2 = EmptyTreeSet[int]()
    for i := 0; i < 1000; i++ {
        set1 = set1.Add(i)
        set2 = set2.Add(i + 500)
    }
    var ns = measureNs(100, () => {
        var _ = set1.Intersect(set2)
    })
    printResult("TreeSet.Intersect (2x1000)", ns)
}

// TreeSet range benchmark
func benchTreeSetRange() {
    var set = EmptyTreeSet[int]()
    for i := 0; i < 10000; i++ {
        set = set.Add(i)
    }
    var ns = measureNs(1000, () => {
        var _ = set.Range(2500, 7500)
    })
    printResult("TreeSet.Range (size=10000)", ns)
}

// ============ HASHMAP BENCHMARKS ============

// HashMap creation benchmark - small
func benchHashMapCreation100() {
    var ns = measureNs(1000, () => {
        var m = EmptyHashMap[int, int]()
        for i := 0; i < 100; i++ {
            m = m.Put(i, i)
        }
    })
    printResult("HashMap.Creation(100)", ns)
}

// HashMap creation benchmark - medium
func benchHashMapCreation10000() {
    var ns = measureNs(100, () => {
        var m = EmptyHashMap[int, int]()
        for i := 0; i < 10000; i++ {
            m = m.Put(i, i)
        }
    })
    printResult("HashMap.Creation(10000)", ns)
}

// HashMap creation benchmark - large
func benchHashMapCreation100000() {
    var ns = measureNs(10, () => {
        var m = EmptyHashMap[int, int]()
        for i := 0; i < 100000; i++ {
            m = m.Put(i, i)
        }
    })
    printResult("HashMap.Creation(100000)", ns)
}

// HashMap put benchmark (single element)
func benchHashMapPut() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(100000, () => {
        var _ = m.Put(99999, 99999)
    })
    printResult("HashMap.Put (size=10000)", ns)
}

// HashMap get benchmark - hit
func benchHashMapGetHit() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(1000000, () => {
        var _ = m.Get(5000)
    })
    printResult("HashMap.Get hit (size=10000)", ns)
}

// HashMap get benchmark - miss
func benchHashMapGetMiss() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(1000000, () => {
        var _ = m.Get(99999)
    })
    printResult("HashMap.Get miss (size=10000)", ns)
}

// HashMap contains benchmark - hit
func benchHashMapContainsHit() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(1000000, () => {
        var _ = m.Contains(5000)
    })
    printResult("HashMap.Contains (hit, size=10000)", ns)
}

// HashMap contains benchmark - miss
func benchHashMapContainsMiss() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(1000000, () => {
        var _ = m.Contains(20000)
    })
    printResult("HashMap.Contains (miss, size=10000)", ns)
}

// HashMap remove benchmark
func benchHashMapRemove() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(100000, () => {
        var _ = m.Remove(5000)
    })
    printResult("HashMap.Remove (size=10000)", ns)
}

// HashMap filter benchmark
func benchHashMapFilter() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(100, () => {
        var _ = m.Filter((k int, v int) => v % 2 == 0)
    })
    printResult("HashMap.Filter (size=10000)", ns)
}

// HashMap mapValues benchmark
func benchHashMapMapValues() {
    var m = EmptyHashMap[int, int]()
    for i := 0; i < 10000; i++ {
        m = m.Put(i, i)
    }
    var ns = measureNs(100, () => {
        var _ = m.MapValues[int]((v int) => v * 2)
    })
    printResult("HashMap.MapValues (size=10000)", ns)
}

// HashMap putAll (merge) benchmark
func benchHashMapPutAll() {
    var m1 = EmptyHashMap[int, int]()
    var m2 = EmptyHashMap[int, int]()
    for i := 0; i < 1000; i++ {
        m1 = m1.Put(i, i)
        m2 = m2.Put(i + 500, i + 500)
    }
    var ns = measureNs(100, () => {
        var _ = m1.PutAll(m2)
    })
    printResult("HashMap.PutAll (2x1000)", ns)
}

// HashMap string keys benchmark
func benchHashMapStringKeys() {
    var m = EmptyHashMap[string, int]()
    var keys []string
    for i := 0; i < 10000; i++ {
        var key = "key" + string(rune(i%26+65)) + string(rune((i/26)%26+65))
        keys = append(keys, key)
        m = m.Put(key, i)
    }
    var ns = measureNs(100000, () => {
        var _ = m.Get(keys[5000])
    })
    printResult("HashMap.Get string key (size=10000)", ns)
}

func main() {
    fmt.Println("=== GALA Immutable Collections Performance ===")
    fmt.Println("Testing with 10,000 - 100,000 elements")
    fmt.Println("")

    fmt.Println("--- List Operations ---")
    benchListCreation100()
    benchListCreation10000()
    benchListCreation100000()
    benchListPrepend()
    benchListHead()
    benchListGetFirst()
    benchListGetMiddle()
    benchListFilter()
    benchListMap()
    benchListFoldLeft()

    fmt.Println("")
    fmt.Println("--- Array (Vector) Operations ---")
    benchArrayCreation100()
    benchArrayCreation10000()
    benchArrayCreation100000()
    benchArrayAppend()
    benchArrayPrepend()
    benchArrayHead()
    benchArrayGetFirst()
    benchArrayGetMiddle()
    benchArrayGetLast()
    benchArrayUpdate()
    benchArrayFilter()
    benchArrayMap()
    benchArrayFoldLeft()
    benchArrayTake()
    benchArrayDrop()

    fmt.Println("")
    fmt.Println("--- HashSet Operations ---")
    benchHashSetCreation100()
    benchHashSetCreation10000()
    benchHashSetCreation100000()
    benchHashSetAdd()
    benchHashSetContainsHit()
    benchHashSetContainsMiss()
    benchHashSetRemove()
    benchHashSetFilter()
    benchHashSetUnion()
    benchHashSetIntersect()

    fmt.Println("")
    fmt.Println("--- TreeSet Operations ---")
    benchTreeSetCreation100()
    benchTreeSetCreation10000()
    benchTreeSetCreation100000()
    benchTreeSetAdd()
    benchTreeSetContainsHit()
    benchTreeSetContainsMiss()
    benchTreeSetRemove()
    benchTreeSetMin()
    benchTreeSetMax()
    benchTreeSetFilter()
    benchTreeSetUnion()
    benchTreeSetIntersect()
    benchTreeSetRange()

    fmt.Println("")
    fmt.Println("--- HashMap Operations ---")
    benchHashMapCreation100()
    benchHashMapCreation10000()
    benchHashMapCreation100000()
    benchHashMapPut()
    benchHashMapGetHit()
    benchHashMapGetMiss()
    benchHashMapContainsHit()
    benchHashMapContainsMiss()
    benchHashMapRemove()
    benchHashMapFilter()
    benchHashMapMapValues()
    benchHashMapPutAll()
    benchHashMapStringKeys()
}
